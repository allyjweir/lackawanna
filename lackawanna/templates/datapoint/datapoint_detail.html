{% extends "base.html" %}
{% load static %}
{% load comments %}


{% block css %}
    <link href="{% static 'css/datapoint.css' %}" rel="stylesheet" type="text/css" >
    {{ block.super }}
{% endblock css %}

{% block content %}
        {% get_comment_count for object as comment_count %}
        <div class="col-md-12">
            <div class="page-header">
                <h1>{{ object.name }}<small> A {% if object.filetype %}{{ object.filetype }}{% endif %} part of the <a href="{% url 'project:detail' slug=object.project.slug %}">{{object.project}}</a> project</small></h1>
            </div>

            <div class="row">
                    <!-- Datapoint Viewer -->
                    {% if object.file %}
                        <!-- Show the file -->
                        <div class="embed-responsive embed-responsive-16by9">
                          <iframe class="embed-responsive-item" src="{{ object.file.url }}"></iframe>
                        </div>
                    {% else %}
                        <!-- Show that no file is associated with the datapoint -->
                        <span class="fa-stack fa-5x">
                          <i class="fa fa-file fa-stack-1x"></i>
                          <i class="fa fa-ban fa-stack-2x text-danger"></i>
                        </span>
                    {% endif %}
            </div>

            <br>

            <!-- Metadata and controls -->
            <div class="row">

                <!-- Navigation Tab Controls -->
                <ul class="nav nav-tabs" role="tablist" id="datapoint-tabs">
                    <li role="presentation" class="active">
                        <a href="#info" role="tab" data-toggle="tab">
                            <i class="fa fa-info-circle"></i> Info
                        </a>
                    </li>
                    <li role="presentation">
                        <a href="#transcripts" role="tab" data-toggle="tab">
                            <i class="fa fa-file"></i> Transcripts <span class="badge">{{transcript_count}}</span>
                        </a>
                    </li>
                    <li role="presentation">
                        <a href="#annotations" role="tab" data-toggle="tab">
                            <i class="fa fa-pencil"></i> Annotations <span class="badge">0</span>
                        </a>
                    </li>
                    <li role="presentation">
                        <a href="#discuss" role="tab" data-toggle="tab">
                            <i class="fa fa-comment"></i> Discussion <span class="badge">{{comment_count}}</span>
                        </a>
                    </li>
                </ul>

                <!-- Tabs' Content -->
                <div class="tab-content">

                    <!-- Info Tab -->
                    <div role="tabpanel" class="tab-pane active" id="info">
                        <br>
                        <div class="col-md-12">
                            <!-- Metadata -->
                            <div class="col-md-8">
                                <div class="col-md-6">
                                    <!-- pk -->
                                    <div class="row">
                                        <b>pk:</b>
                                        <p id="pk">{{ object.pk }}</p>
                                        <br>
                                        <b>project pk:</b>
                                        <p id="project-pk">{{ object.project.pk }}</p>
                                    </div>
                                    <!-- Description -->
                                    <div class="row">
                                        <b>Description:</b>
                                        {% if object.description %}
                                            <p>{{ object.description }}</p>
                                        {% else %}
                                            <p><i>No description given</i></p>
                                        {% endif %}
                                    </div>

                                    <!-- Author -->
                                    <div class="row">
                                        <b>Author:</b>
                                        {% if object.author %}
                                            <p>{{ object.author }}</p>
                                        {% else %}
                                            <p><i>No author provided</i></p>
                                        {% endif %}
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <!-- Source and URL Link -->
                                    <div class="row">
                                        <b>Source:</b>
                                        {% if object.source %}
                                            <a href="{{ object.url }}">{{ object.source }}</a>
                                        {% else %}
                                            <p><i>No source provided</i></p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div> <!-- .col-md-8 -->

                            <!-- Buttons -->
                            <div class="col-md-4">
                                <div class="btn-toolbar">
                                    <!-- Collections Buttons -->
                                    <button id="collections-button" type="button" class="btn btn-default" data-toggle="modal" data-target="#collection-Modal">
                                        <i class="fa fa-archive"></i> Add to Collection
                                    </button>

                                    <!-- Download Button -->
                                    <a class="btn btn-default" href="/media/{{ object.file }}">
                                        <i class="fa fa-cloud-download"></i></i> Download
                                    </a>

                                    <!-- Delete Button -->
                                    <a class="btn btn-danger" href="{% url 'datapoint:delete' pk=object.pk %}">
                                        <i class="fa fa-trash-o fa-lg"></i> Delete
                                    </a>
                                </div>
                            </div> <!-- .col-md-4 -->
                        </div><!-- .col-md-12 -->
                    </div> <!-- .tabpanel -->

                    <!-- Transcripts Tab -->
                    <div role="tabpanel" class="tab-pane" id="transcripts">
                        <br/>
                        <div class="row">
                            <div class="col-md-12">
                                <a class="btn btn-primary btn-lg pull-right" href="{% url 'about' %}">
                                    <i class="fa fa-plus"></i> Create new transcript
                                </a>
                            </div>
                        </div>

                        {% if transcripts %}
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                  <th>Name</th>
                                  <th>Created By</th>
                                  <th>Last Modified</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for transcript in transcripts %}
                                <tr>
                                    <td><a href="{% url 'transcript:viewer' pk=transcript.pk %}">{{ transcript.name }}</a></td>
                                    <td><a href="{% url 'users:detail' username=transcript.creator %}">{{ transcript.creator.first_name }} {{ transcript.creator.last_name }}</a></td>
                                    <td>{{ transcript.modified}}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <h2>No Transcripts</h2>
                        <p>There are no transcripts for this datapoint yet. Let's change that! Push that big blue button
                            up there</p>
                        {% endif %}
                    </div> <!-- .tab-pane #transcripts -->

                    <!-- Annotations Tab -->
                    <div role="tabpanel" class="tab-pane" id="annotations">
                        <h1>There will be a list of annotations here</h1>
                    </div> <!-- .tab-pane #annotations -->


                    <!-- Discussion Tab -->
                    <div role="tabpanel" class="tab-pane" id="discuss">
                        <h1>Discussions here. Get your discussion here!</h1>
                        <p>There are {{comment_count}} comments</p>
                    </div> <!-- .tab-pane #discuss -->

                </div> <!-- .tabcontent -->
            </div><!-- .row -->
        </div><!-- .col-md-12-->

        <!-- Add/Remove from Collections Modal -->
        <div class="modal fade" id="collection-Modal" tabindex="-1" role="dialog" aria-labelledby="collectionModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="myModalLabel">Change Collections</h4>
                    </div>
                    <div class="modal-body">
                        <div id="loading-spinner">
                            <i class="fa fa-refresh fa-spin"></i>
                            <p>
                                Loading Collections...
                            </p>
                        </div>
                        <div id="collections-list">

                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button id="collections-save-button" data-loading-text="Saving..." type="button" class="btn btn-primary">Save changes</button>
                    </div>
                </div>
            </div>
        </div><!-- .modal fade -->
{% endblock content %}

{% block javascript %}
        {{ block.super }}
        <script src="{% static 'js/datapoint.js' %}"></script>
{% endblock javascript %}
